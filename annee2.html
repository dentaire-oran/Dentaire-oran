<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  <title>2√®me Ann√©e Dentaire - Calculateur</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #2e5c4d;
    }
    .module {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      background-color: #fff;
    }
    .module h3 {
      margin-top: 0;
    }
    input[type="number"] {
      width: 60px;
      padding: 5px;
      margin-right: 10px;
      margin-top: 5px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .result {
      margin-top: 30px;
      font-size: 18px;
      font-weight: bold;
    }
    .alert {
      padding: 10px;
      margin-top: 15px;
      border-radius: 5px;
    }
    .success { background-color: #d4edda; color: #155724; }
    .warning { background-color: #fff3cd; color: #856404; }
    .danger  { background-color: #f8d7da; color: #721c24; }
    .moyenne-module { margin-top: 10px; font-size: 15px; color: #333; font-style: italic; }
    .manual-moyenne-label {
      font-size: 13px; 
      font-style: italic;
      margin-left: 15px;
      margin-right: 8px;
      color: #2e5c4d;
    }
    .manual-moyenne-input {
      width: 80px;
      padding: 5px;
      margin-left: 8px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>Calculateur 2√®me Ann√©e Dentaire</h1>
  <form id="form"></form>
  <button type="button" onclick="calculer()">Calculer</button>
  <button type="button" onclick="saveResults()">Enregistrer les r√©sultats</button>
  <button type="button" onclick="loadResults()">Charger les r√©sultats</button>
  <div class="result" id="resultat"></div>  <script>
    const modules = [
      { nom: "OCE", coef: 5, emd1: true, emd2: true, td: false, tp: true, tpDouble: true },
      { nom: "Proth√®se", coef: 5, emd1: true, emd2: true, td: false, tp: true, tpDouble: true },
      { nom: "AH", coef: 4, emd1: true, emd2: true, td: false, tp: true, tpDouble: true },
      { nom: "AD", coef: 3, emd1: true, emd2: false, td: false, tp: true, tpDouble: true },
      { nom: "ODF", coef: 3, emd1: true, emd2: true, td: false, tp: false },
      { nom: "Patho", coef: 3, emd1: false, emd2: true, td: false, tp: false },
      { nom: "Paro", coef: 3, emd1: false, emd2: true, td: true, tp: false },
      { nom: "Biomat", coef: 2, emd1: true, emd2: true, td: false, tp: false },
      { nom: "Histo", coef: 2, emd1: true, emd2: false, td: true, tp: false },
      { nom: "Microbio", coef: 2, emd1: true, emd2: true, td: false, tp: false },
      { nom: "Hygi√®ne", coef: 1, emd1: true, emd2: false, td: false, tp: false },
      { nom: "Immuno", coef: 1, emd1: false, emd2: true, td: false, tp: false },
      { nom: "Info", coef: 1, emd1: true, emd2: true, td: false, tp: false },
      { nom: "Physio", coef: 1, emd1: false, emd2: true, td: false, tp: false },
      { nom: "Anglais", coef: 1, emd1: true, emd2: false, td: false, tp: false }
    ];

    const form = document.getElementById("form");

    modules.forEach((mod, i) => {
      const div = document.createElement("div");
      div.className = "module";
      div.innerHTML = `
        <h3>${mod.nom}</h3>
        <label class="manual-moyenne-label">
          <input type="checkbox" id="${i}_manual_moyenne_cb" onchange="toggleManualMoyenne(${i})">
          Entrer la moyenne manuellement
        </label><br>
        <input type="number" step="0.01" min="0" max="20" style="display:none;" class="manual-moyenne-input" id="${i}_manual_moyenne" placeholder="Moyenne du module">
        <div id="${i}_notes_fields">
          ${mod.emd1 ? `EMD S1: <input type="number" step="0.01" min="0" max="20" id="${i}_emd1"><br>` : ""}
          ${mod.emd2 ? `EMD S2: <input type="number" step="0.01" min="0" max="20" id="${i}_emd2"><br>` : ""}
          ${mod.td ? `TD: <input type="number" step="0.01" min="0" max="20" id="${i}_td"><br>` : ""}
          ${mod.tp ? `TP: <input type="number" step="0.01" min="0" max="20" id="${i}_tp"><br>` : ""}
        </div>
        <div class="moyenne-module" id="${i}_moyenne_module"></div>
      `;
      form.appendChild(div);
    });

    function toggleManualMoyenne(i) {
      const cb = document.getElementById(`${i}_manual_moyenne_cb`);
      const manualInput = document.getElementById(`${i}_manual_moyenne`);
      const notesFields = document.getElementById(`${i}_notes_fields`);

      if (cb.checked) {
        manualInput.style.display = "inline-block";
        manualInput.disabled = false;
        notesFields.style.display = "none";
      } else {
        manualInput.style.display = "none";
        manualInput.disabled = true;
        notesFields.style.display = "block";
      }
    }

    function calculer() {
      let total = 0;
      let totalCoef = 0;
      let modulesMoinsDe5 = [];
      let modulesMoinsDe10 = [];

      modules.forEach((mod, i) => {
        const cb = document.getElementById(`${i}_manual_moyenne_cb`);
        const manualInput = document.getElementById(`${i}_manual_moyenne`);
        let moyenne = 0;

        if (cb.checked && manualInput.value !== "") {
          moyenne = Number(manualInput.value) || 0;
        } else {
          let totalNote = 0;
          let diviseur = 0;

          if (mod.emd1) {
            totalNote += Number(document.getElementById(`${i}_emd1`).value) || 0;
            diviseur++;
          }
          if (mod.emd2) {
            totalNote += Number(document.getElementById(`${i}_emd2`).value) || 0;
            diviseur++;
          }
          if (mod.td) {
            totalNote += Number(document.getElementById(`${i}_td`).value) || 0;
            diviseur++;
          }
          if (mod.tp) {
            let tpNote = Number(document.getElementById(`${i}_tp`).value) || 0;
            totalNote += mod.tpDouble ? tpNote * 2 : tpNote;
            diviseur += mod.tpDouble ? 2 : 1;
          }

          moyenne = diviseur > 0 ? totalNote / diviseur : 0;
        }

        document.getElementById(`${i}_moyenne_module`).textContent = `Moyenne du module : ${moyenne.toFixed(2)}`;

        if (moyenne < 5) modulesMoinsDe5.push(mod.nom);
        else if (moyenne < 10) modulesMoinsDe10.push(mod.nom);

        total += moyenne * mod.coef;
        totalCoef += mod.coef;
      });

      const moyenneGenBrute = total / totalCoef;
      const moyenneGen = moyenneGenBrute.toFixed(3);

      let html = `<div class="alert">Moyenne g√©n√©rale : <strong>${moyenneGen}</strong></div>`;

      if (moyenneGenBrute >= 10 && modulesMoinsDe5.length === 0) {
        html += `<div class="alert success">F√©licitations üéâ, ann√©e valid√©e.</div>`;
      } else if (moyenneGenBrute < 10 && modulesMoinsDe5.length > 0) {
        html += `<div class="alert danger"><strong>Ann√©e non valid√©e</strong><br>Moyenne insuffisante + modules < 5.</div>`;
        html += `<div class="alert warning">Modules < 5 :<ul>${modulesMoinsDe5.map(m => `<li>${m}</li>`).join('')}</ul></div>`;
        html += `<div class="alert warning">Modules entre 5 et 10 :<ul>${modulesMoinsDe10.filter(m => !modulesMoinsDe5.includes(m)).map(m => `<li>${m}</li>`).join('')}</ul></div>`;
      } else if (modulesMoinsDe5.length > 0) {
        html += `<div class="alert danger">Rattrapage obligatoire dans les modules suivants :<ul>${modulesMoinsDe5.map(m => `<li>${m}</li>`).join('')}</ul></div>`;
      } else if (moyenneGenBrute < 10) {
        html += `<div class="alert warning">Moyenne g√©n√©rale insuffisante. Modules < 10 :<ul>${modulesMoinsDe10.map(m => `<li>${m}</li>`).join('')}</ul></div>`;
      }

      document.getElementById("resultat").innerHTML = html;
    }

    function saveResults() {
      let data = {};
      modules.forEach((mod, i) => {
        data[`${i}_manual_moyenne_cb`] = document.getElementById(`${i}_manual_moyenne_cb`).checked;
        data[`${i}_manual_moyenne`] = document.getElementById(`${i}_manual_moyenne`).value;
        if (mod.emd1) data[`${i}_emd1`] = document.getElementById(`${i}_emd1`).value;
        if (mod.emd2) data[`${i}_emd2`] = document.getElementById(`${i}_emd2`).value;
        if (mod.td) data[`${i}_td`] = document.getElementById(`${i}_td`).value;
        if (mod.tp) data[`${i}_tp`] = document.getElementById(`${i}_tp`).value;
      });
      localStorage.setItem("annee2_results", JSON.stringify(data));
      alert("R√©sultats enregistr√©s !");
    }

    function loadResults() {
      let data = JSON.parse(localStorage.getItem("annee2_results") || '{}');
      modules.forEach((mod, i) => {
        if (typeof data[`${i}_manual_moyenne_cb`] !== "undefined") {
          document.getElementById(`${i}_manual_moyenne_cb`).checked = data[`${i}_manual_moyenne_cb`];
        }
        if (typeof data[`${i}_manual_moyenne`] !== "undefined") {
          document.getElementById(`${i}_manual_moyenne`).value = data[`${i}_manual_moyenne`];
        }
        if (mod.emd1 && typeof data[`${i}_emd1`] !== "undefined") document.getElementById(`${i}_emd1`).value = data[`${i}_emd1`];
        if (mod.emd2 && typeof data[`${i}_emd2`] !== "undefined") document.getElementById(`${i}_emd2`).value = data[`${i}_emd2`];
        if (mod.td && typeof data[`${i}_td`] !== "undefined") document.getElementById(`${i}_td`).value = data[`${i}_td`];
        if (mod.tp && typeof data[`${i}_tp`] !== "undefined") document.getElementById(`${i}_tp`).value = data[`${i}_tp`];
        toggleManualMoyenne(i);
      });
      calculer();
      alert("R√©sultats charg√©s !");
    }

    window.onload = () => {
      modules.forEach((mod, i) => {
        toggleManualMoyenne(i);
      });
    };
  </script></body>
</html>